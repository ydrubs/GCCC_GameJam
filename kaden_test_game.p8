pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
pal(0,129,1)

function _init()
	can_move = true
	enemies={}
	
	for i=1,2 do
		add(enemies,enemy:new({
			x=flr(rnd(10)),
			y=flr(rnd(10))
		}))
	end
end

function _update()

	--[[
		currnetly just checks if for
		movement and if the menu is
		open or not.]]
		
	if can_move then
		player:movement()
		if player.moved == true then
			for enemy in all(enemies) do
				enemy:movement()
			end
			player.moved = false
		end
	elseif not can_move then
		if btnp(🅾️) then
			menu:open()
		end
	end
end

function _draw()
	cls()
	map()
	
	player:draw()
	menu:draw()

	player_camera:update()
	
	for enemy in all(enemies) do
		enemy:draw()
	end
	
	if not can_move then
		menu:nav()
	end

	--[[below are the dimentions of
		the horizontal inv box i'll
		use it later.]]
		
	--[[if menu.opened == true then
	 rect(player_camera.x+2,player_camera.y+83,player_camera.x+125,player_camera.y+125,7)
		rectfill(player_camera.x+3,player_camera.y+84,player_camera.x+124,player_camera.y+124,1)
		print("\n-inventory\n\n-settings\n\n-exit",player_camera.x+4,player_camera.y+85,7)
	end]]

end
-->8
--player

player={
	x=8,
	y=8,
	
	movement=function(self)
		--[[the function will read
			user input, and call the
			wall system to check for
			opsticals.]]
				
		if btnp(⬆️) then
			if walls:check(self.x,self.y-1) then
				self.y-=1
				self.moved=true
			end
		elseif btnp(⬇️) then
			if walls:check(self.x,self.y+1) then
				self.y+=1
				self.moved=true
			end
		elseif btnp(⬅️) then
			if walls:check(self.x-1,self.y) then
				self.x-=1
				self.moved=true
			end
		elseif btnp(➡️) then
		 if walls:check(self.x+1,self.y) then
				self.x+=1
				self.moved=true
			end
		end
		
		if btnp(🅾️) then
			menu:open()
		end
	end,
	
	draw=function(self)
		spr(1, self.x*8, self.y*8)
	end
}
-->8
--systems

walls={
	--checks for walls... big whoop
	
	check=function(self,x,y)
		local _spr = mget(x,y)
		local _flg = fget(_spr, 0)
	
		if _flg == true then
			return false
		else
			return true
		end
	end
}

player_camera={
	x = 0,
	y = 0,

	
	--[[player_camera checks if they
	have entered a new screen and
	if so it will draw it.]]
	
	update=function(self)
		if player.x % 16 == 0 then
			self.x = player.x*8
			return camera(self.x, self.y)
		elseif player.y % 16 == 0 then
			self.y = player.y*8
			return camera(self.x, self.y)
		end
		
		if player.x % 16 == 15 then
			self.x = (player.x-15)*8
			return camera(self.x, self.y)
		elseif player.y % 16 == 15 then
			self.y = (player.y-15)*8
			return camera(self.x, self.y)
		end
	end
}

menu={
	opened = false,
	can_move=true,
	x = player_camera.x+116,
	y = player_camera.y+4,
	pos = 1,
	--[[overall menu system for
		the game, pretty proud of it
		so far.]]
	
	open = function(self)
		--[[checks the menu is open
			if so it pauses the players
			movement]]
		if self.opened then
		 self.opened = false
		 can_move = true
		else
			self.opened = true
			can_move = false
			self.x = player_camera.x+116
			self.y = player_camera.y+4
		end
	end,
	
	draw = function(self)
		--draws the menu if it is open
		if menu.opened == true then
		 rect(player_camera.x+95,player_camera.y+1,player_camera.x+125,player_camera.y+40,7)
			rectfill(player_camera.x+96,player_camera.y+2,player_camera.x+124,player_camera.y+39,1)
			print("\ninv\n\nequip\n\nparty",player_camera.x+97,player_camera.y,7)
		end
	end,
	
	nav = function(self)
		--[[grabs a cursor position
			and draws it to the screen
			if the player inputs ⬆️ or ⬇️
			then they will be able to
			move the cursor and
			eventually select the option.
			]]
		if self.pos >= 1 and self.pos <= 3 then
			if self.pos == 1 then
				spr(9,self.x,self.y)
			elseif self.pos == 2 then
				spr(9,self.x,self.y)
			elseif self.pos == 3 then
				spr(9,self.x,self.y)
			end
		
			if btnp(⬇️) then
				self.y += 12
				self.pos += 1
			elseif btnp(⬆️) and self.pos != 1 then
				self.y -= 12
				self.pos -= 1
			end
		else
			self.pos = 1
			self.x = player_camera.x+116
			self.y = player_camera.y+4
		end	
	end
}


-->8
--enemy
enemy={
	round=1,
	x=0,
	y=0,
	
	new=function(self,tbl)
		--[[this is the first time im
			using lua's metatables in a
			project. still a pretty weird
		 concept to grasp coming over
		 from python.
		 
		 as i understand so far, this
		 function is a constructor
		 method for the "class" of 
		 enemy. this allows me to 
		 create child nodes and give
		 them unique variables.]]
	
		tbl=tbl or {}
		setmetatable(tbl,{
			__index=self
		})
		return tbl
	end,
	
	
	angle=function(self,px,py)		
		local tanx = self.x - px
		local tany = self.y - py
		
		return atan2(tanx, tany)
	end,
	
	movement=function(self)
		local cosp = -cos(self:angle(player.x,player.y))
		local sinp = sin(self:angle(player.x,player.y))
		--[[in an effort to simplify how
			enemies move, i used basic 
			trig to essentially shoot out
			a 45 deg. angle from all
			sides and have it move to
			the player.

			tye and i discovered that 
			the movement function acts
			pretty odd when using the
			round variable that was
			created in the init function.]]
		
		if self.round == 3 then
			self.round = 1
			
			if cosp >= -0.7071 and cosp < 0.7017 and sinp > 0 then
				if walls:check(self.x,self.y-1) then
					self.y -= 1
				end
			elseif cosp >= -0.7071 and cosp < 0.7017 and sinp < 0 then
				if walls:check(self.x,self.y+1) then
					self.y += 1
				end
			elseif sinp >= -0.7071 and sinp < 0.7017 and cosp > 0 then
				if walls:check(self.x+1,self.y) then
					self.x += 1
				end
			elseif sinp >= -0.7071 and sinp < 0.7017 and cosp < 0 then
				if walls:check(self.x-1,self.y) then
					self.x -= 1
				end
			end
		else
			self.round += 1
		end
	end,	
	
	
	draw=function(self)
		spr(4, self.x*8, self.y*8)
	end,
	
}
__gfx__
00000000d0ddd0d06066606000000000002020005555555500000000676667606068606000000000000000000000000000000000000000000000000000000000
000000000d9d9d00000000000000000000222000c00000050c000000077777000088800000000000000000000000000000000000000000000000000000000000
0070070000ddd000666066600000000000929000c0d000050cd0000067ccc7606888886000000000000000000000000000000000000000000000000000000000
00077000055d5500000000000000000000000000c0d0c00501dc000007ccc7000008000000007000000000000000000000000000000000000000000000000000
0007700000555000606660600000000000020000c0d0c0d5011cd00067ccc7606068606000077777000000000000000000000000000000000000000000000000
007007000d050d00000000000000000002000200c0d0c0d50111dc00007c70000008000000007000000000000000000000000000000000000000000000000000
00000000000d0000666066600005000000020000c0d0c0d501111c00666766606668666000000000000000000000000000000000000000000000000000000000
0000000000d0d0000000000000000000002020005555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030302020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030303020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202080203020202020702030203030303030303030303030302030302000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303030303030303030303030303030303030303030203030302000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303030303030303030303030303030303030303030303030502000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303030303030303030303030303030303030303030303030502000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303030303030303030303030303030303030303030203030302000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020203020202020202020203030303030303030303030302030302000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030303020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030302020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303030303030303030203030303030303030303030202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203030303030303020303030303030203030303030303030303030202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000d00200e3500e3500e3500f3500f3500f3500f3500f3500f3500f35010350103501135012350123501335013350133501435014350143501535016350163501735018350183501835018350183501735016350
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002000001885000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 01424344

